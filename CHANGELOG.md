# Changelog

## [2025-09-07] - 最新更新

### 🔧 优化改进 (Improvements)

#### 🎯 混合类型结果处理优化
- **6165e73** - 清理混合类型结果处理的冗余代码
  - 删除handlers/import_media.py中'进入搜索流程'按钮
  - 移除callback/import_media.py中import_auto_search回调处理逻辑
  - 删除不再使用的handle_search_redirect函数
  - 保留手动类型选择功能用于TMDB未配置或搜索失败的场景
  - **文件变更**: 2个文件，9行新增，31行删除

- **xxxxxxx** - 增加默认 API 超时时间至 120 秒
  - 提高在网络波动情况下的请求成功率
  - 更新 README 与 Dockerfile 中的默认配置说明

- **a60726f** - 优化混合类型结果处理逻辑：添加搜索流程引导按钮
  - 为混合类型结果添加"进入搜索流程"按钮
  - 优化用户界面交互体验
  - 改进搜索流程的引导逻辑
  - **文件变更**: 2个文件，31行新增，1行删除

#### 🐛 问题修复 (Bug Fixes)
- **90f0e33** - 修复季度选择功能和关键词搜索显示逻辑
  - 修复季度选择界面的显示问题
  - 优化关键词搜索的逻辑处理
  - 改进用户交互流程

#### 📚 文档更新 (Documentation)
- **d2db2ac** - docs: 添加详细的变更日志文档
  - 完善CHANGELOG.md文档结构
  - 添加详细的功能说明和技术特性
  - 优化文档格式和可读性

#### 🎬 功能增强 (Feature Enhancements)
- **3e4f8e9** - feat: 添加季度解析功能和优化导入逻辑
  - 为豆瓣、BGM爬虫添加季度解析功能
  - 增强TMDB、TVDB、IMDB的季度信息获取
  - 添加季度选择界面和处理逻辑
  - 优化导入流程，支持智能季度识别
  - **文件变更**: 9个文件，593行新增，24行删除

#### ♻️ 重构优化 (Refactoring)
- **b444589** - refactor: 移除已废弃的分季和分集导入功能，优化自动导入流程
  - 清理废弃的分季分集导入代码
  - 优化自动导入流程逻辑
  - 简化代码结构，提高维护性
  - **文件变更**: 6个文件，684行新增，468行删除

- **4eb305b** - 精简用户界面文案提示
  - 优化用户界面的文案表达
  - 简化提示信息，提高用户体验
  - **文件变更**: 3个文件，15行新增，16行删除

- **5e413de** - 重构: 移除动态轮询管理器并优化环境变量配置
  - 移除不再使用的动态轮询管理器
  - 优化环境变量配置结构
  - 简化系统架构，提高性能
  - **文件变更**: 5个文件，19行新增，263行删除

#### 📖 文档完善 (Documentation)
- **a253d93** - docs: 添加管理员ID配置说明到README
  - 完善README文档中的配置说明
  - 添加管理员权限相关的配置指导
  - **文件变更**: 1个文件，26行新增，1行删除

#### 👑 权限管理 (Permission Management)
- **ddb71df** - feat: 添加管理员权限控制和菜单优化
  - 实现管理员权限控制系统
  - 优化菜单结构和权限验证
  - 增强系统安全性和用户管理
  - **文件变更**: 6个文件，173行新增，48行删除
- **xxxxxxx** - feat: 允许普通用户查询全局配额
  - 移除 `/quota` 命令的管理员限制
  - 更新权限说明和帮助文档
  - **文件变更**: 4个文件，14行新增，9行删除

---

## [2025-09-07] - 季度解析功能和导入逻辑优化

### ✨ 新功能 (Features)

#### 🎬 季度解析系统
- **豆瓣爬虫季度解析**: 为豆瓣爬虫添加从标题自动解析季度信息的功能
- **BGM爬虫季度解析**: 为BGM爬虫添加标题季度解析功能，支持多种季度表达方式
- **智能季度识别**: 支持识别"第二季"、"第2季"、"Season 2"等多种季度表达格式
- **中文数字转换**: 自动将中文数字（一、二、三等）转换为阿拉伯数字

#### 📺 电视剧季度管理
- **TMDB季度信息**: 增强TMDB API获取电视剧详细信息，添加季度数量解析功能
- **TVDB季度支持**: 修改TVDB API增加获取电视剧季度信息的功能
- **IMDB季度解析**: 修改IMDB爬虫增加获取电视剧季度信息的功能
- **季度选择界面**: 在导入流程中添加季度选择界面和处理逻辑

### 🔧 优化改进 (Improvements)

#### 📥 导入流程优化
- **默认季度设置**: 当标题未解析到季度信息时，自动默认设置为第1季
- **智能导入逻辑**: 优化导入流程，支持单季直接导入和多季选择
- **回调处理增强**: 修改回调处理函数以支持季度选择功能

#### 🐛 问题修复 (Bug Fixes)
- **平台匹配修复**: 修复validate_platform_match函数返回None的问题
- **消息发送修复**: 修复豆瓣导入的消息发送方式，使用正确的消息接口

### 📁 文件变更统计 (File Changes)

```
修改的文件: 9个
新增代码: 593行
删除代码: 24行
```

#### 主要修改文件:
- `handlers/import_media.py` - 导入逻辑和季度选择界面
- `utils/douban_scraper.py` - 豆瓣季度解析功能
- `utils/bgm_scraper.py` - BGM季度解析功能
- `utils/tmdb_api.py` - TMDB季度信息获取
- `utils/tvdb_api.py` - TVDB季度信息获取
- `utils/imdb_scraper.py` - IMDB季度解析
- `callback/import_media.py` - 回调处理优化
- `bot.py` - 核心功能集成
- `handlers/__init__.py` - 模块初始化

### 🎯 技术特性 (Technical Features)

- **正则表达式匹配**: 使用多种正则模式精确匹配季度信息
- **异常处理**: 完善的错误处理机制，确保解析失败时的优雅降级
- **统一接口**: 为不同平台提供统一的季度解析接口
- **向后兼容**: 保持与现有功能的完全兼容性

### 📈 用户体验提升 (UX Improvements)

- **自动化程度提高**: 减少用户手动选择季度的需求
- **智能默认值**: 提供合理的默认季度设置
- **清晰的反馈**: 提供详细的导入状态和季度信息反馈
- **流程简化**: 优化导入流程，减少不必要的用户交互

---

**提交哈希**: `3e4f8e9`  
**提交时间**: 2025-09-07 14:36:29 +0800  
**作者**: balge <wchengba@gmail.com>